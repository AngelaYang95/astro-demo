---
import Layout from '../layouts/Layout.astro';
import BaseHeading from '../storybloks/BaseHeading.astro';
import SliceGrid from '../layouts/SliceGrid.astro';
import Column from '../layouts/Column.astro';
import { getLiveStory, useStoryblokApi } from '@storyblok/astro';
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro'

// Write a helper for this.
const { slug } = Astro.params;
let story = null;

const liveStory = await getLiveStory(Astro);
if (liveStory) {
  story = liveStory;
} else {
  const sbApi = useStoryblokApi();
  const { data } = await sbApi.get(`cdn/stories/${slug || 'home'}`, {
    version: 'draft',
  });
  story = data?.story;
}

const content = story.content;
console.log('Content:', content);
---
<Layout>
	{
		content.body?.map((blok) => {
			return <StoryblokComponent blok={blok} />
		})
	}
</Layout>